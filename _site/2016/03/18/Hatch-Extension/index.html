<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Hatch Extension and Pair programming &middot; Miguel
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/style.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0d">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Miguel
        </a>
      </h1>
      <p class="lead">Front End Developer</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>


      
      
        
          
        
      
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
      
        
      
      <a class="sidebar-nav-item" href="/MiguelCV.pdf">Resume</a>
      <a class="sidebar-nav-item" href="https://github.com/migueog">GitHub</a>
      <a class="sidebar-nav-item" href="http://codepen.io/miguelog/">Codepen</a>
    </nav>

    <p>&copy; 2016. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Hatch Extension and Pair programming</h1>
  <span class="post-date">18 Mar 2016</span>
  <p>I’ve always been pretty curious with how a chrome extension works. Dallis, my girlfriend, works at a great company called Hatch Canada where they teach kids how to program. She needed to create an extension where you can take a screenshot of a kids project and then create a new tab with a nice layout so the student could print the project out. Dallis eventually came to me for help. It ended up being a great time since we pair programmed through the project and I got learn about chrome extensions.</p>

<p>Let’s walk through our solution. We start off by setting an id which we’ll be using to create a unique tab. We then create 3 event listeners that grabs the 3 things we’ll need from the project page. We’re grabbing the project title, it’s URL, and the canvas.</p>

<p>Initially, Dallis had the extension set up so that it would take a screenshot of the whole browser window and then she would crop out the image. We changed it so that we use toDataURL() on the canvas to get a data URI of the image.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">onClicked</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">executeScript</span><span class="p">(</span>
    <span class="p">{</span> 
      <span class="na">code</span><span class="p">:</span> <span class="s2">" document.getElementsByClassName('project')[0].getElementsByTagName('h2')[0].innerHTML;"</span>
    <span class="p">},</span> 
    <span class="kd">function</span> <span class="p">(</span><span class="nx">ps1</span><span class="p">)</span> <span class="p">{</span>
		  <span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onConnect</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">port</span><span class="p">){</span>
			<span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span><span class="na">text</span><span class="p">:</span> <span class="nx">ps1</span><span class="p">,</span> <span class="na">type</span> <span class="p">:</span> <span class="s2">"title"</span><span class="p">});</span>
		<span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">});</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">onClicked</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">executeScript</span><span class="p">(</span>
    <span class="p">{</span> 
      <span class="na">code</span><span class="p">:</span> <span class="s2">"document.URL"</span>
    <span class="p">},</span> 
    <span class="kd">function</span> <span class="p">(</span><span class="nx">ps2</span><span class="p">)</span> <span class="p">{</span>
		  <span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onConnect</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">port</span><span class="p">){</span>
			<span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span><span class="na">text</span><span class="p">:</span><span class="nx">ps2</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span><span class="s2">"url"</span><span class="p">});</span>
		<span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">});</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">onClicked</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">executeScript</span><span class="p">(</span>
    <span class="p">{</span> 
      <span class="na">code</span><span class="p">:</span> <span class="s2">" document.getElementsByClassName('project')[0].getElementsByTagName('canvas')[0].toDataURL();"</span>
    <span class="p">},</span> 
    <span class="kd">function</span> <span class="p">(</span><span class="nx">ps3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onConnect</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">port</span><span class="p">){</span>
      <span class="nx">port</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span><span class="na">text</span><span class="p">:</span><span class="nx">ps3</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span><span class="s2">"canvas"</span><span class="p">});</span>
    <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">});</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">browserAction</span><span class="p">.</span><span class="nx">onClicked</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">captureVisibleTab</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">screenshotUrl</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">viewTabUrl</span> <span class="o">=</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">getURL</span><span class="p">(</span><span class="s1">'screenshot.html?id='</span> <span class="o">+</span> <span class="nx">id</span><span class="o">++</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">targetId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">onUpdated</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span> <span class="nx">listener</span><span class="p">(</span><span class="nx">tabId</span><span class="p">,</span> <span class="nx">changedProps</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">tabId</span> <span class="o">!=</span> <span class="nx">targetId</span> <span class="o">||</span> <span class="nx">changedProps</span><span class="p">.</span><span class="nx">status</span> <span class="o">!=</span> <span class="s2">"complete"</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

      <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">onUpdated</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">views</span> <span class="o">=</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">extension</span><span class="p">.</span><span class="nx">getViews</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">views</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="nx">views</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">==</span> <span class="nx">viewTabUrl</span><span class="p">)</span> <span class="p">{</span>
			     <span class="nx">view</span><span class="p">.</span><span class="nx">setScreenshotUrl</span><span class="p">(</span><span class="nx">screenshotUrl</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="na">url</span><span class="p">:</span> <span class="nx">viewTabUrl</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tab</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">targetId</span> <span class="o">=</span> <span class="nx">tab</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>The second JS script grabs the project title, URL, and canvas and then writes it into our html. We set up a port variable that connects to background.js and then we listen for the three messages and we put throw them into our newly created tab.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">	<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span><span class="na">name</span><span class="p">:</span><span class="s2">"screenshot"</span><span class="p">});</span>
	<span class="nx">port</span><span class="p">.</span><span class="nx">onMessage</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="nx">sender</span><span class="p">){</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">"title"</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'titleText'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">"url"</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'website'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">"canvas"</span><span class="p">){</span>
		<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'target'</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>With the scripting done, I decided to show Dallis how flex boxes and BEM work. It’s pretty easy to read but for those who don’t know how flexboxes work then what this stylesheet is doing is setting up a parent container which defines the direction of how its children will be laid out and then we wrote the children classes for the three sections.</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.container</span><span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">flex-direction</span><span class="p">:</span> <span class="n">column</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">550px</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">500px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.container__title</span><span class="p">{</span>
  <span class="nl">order</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span><span class="nb">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">118</span><span class="p">,</span><span class="m">165</span><span class="p">);</span>
  <span class="nl">height</span><span class="p">:</span><span class="m">100px</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">5px</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.container__image</span><span class="p">{</span>
  <span class="nl">order</span><span class="p">:</span> <span class="m">2</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span><span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">img</span><span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">500px</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.container__url</span><span class="p">{</span>  
  <span class="nl">order</span><span class="p">:</span> <span class="m">3</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span> 
  <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span><span class="nb">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">118</span><span class="p">,</span><span class="m">165</span><span class="p">);</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">4px</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>It was a great little project for the two of us to work on. Learning something new is a great feeling but it’s even better to help someone out in a bind.</p>


</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/07/20/MaxScheduler/">
            MaxScheduler
            <small>20 Jul 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/07/11/ES6-Concepts/">
            ES6 Concepts
            <small>11 Jul 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/05/01/ToDo-Webapp-with-NodeJS/">
            Todo Web app using the MEAN stack
            <small>01 May 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
